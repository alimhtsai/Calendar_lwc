<!-- 
@description: Lightning web component using Fullcalendar.io js library to display most recent events
@author: Brahmaji tammana from www.auraenabled.com 
@jslibrary: https://fullcalendar.io/ -->

<template>
    <c-notification></c-notification>

    <!-- Spinner to show on waiting screens -->
    <template if:true={openSpinner}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>

    <div class="slds-grid slds-wrap slds-theme_default">
        <div class="slds-col slds-size_3-of-12">
            <div class="slds-p-around_medium slds-border_right slds-scrollable_y" style="height:800px">

                <template for:each={groupedEvents} for:item="weekNumberGroup">
                    <lightning-card key={weekNumberGroup.weekNumber} class="slds-p-left_medium">
                        <h4 slot="title">
                            <span class="slds-p-right_small">
                                <lightning-icon icon-name="standard:event" size="small">
                                </lightning-icon>
                            </span>
                            Week {weekNumberGroup.weekNumber} - Weekly Hours
                            <lightning-formatted-number class="slds-p-left_x-small slds-text-color_error" name="hours"
                                value={weekNumberGroup.weeklyTotalHours} maximum-fraction-digits="2">
                            </lightning-formatted-number>
                        </h4>
                        <template for:each={weekNumberGroup.weeks} for:item="weekGroup">
                            <div key={weekGroup.title} class="slds-p-left_medium slds-p-right_medium">
                                <h4>{weekGroup.title} ({weekGroup.weekday}) Daily Hours {weekGroup.dailyTotalHours}
                                </h4>
                                <!-- <template for:each={titleGroup.events} for:item="event">
                                    <p key={event.id}>
                                        {event.hours} hours
                                    </p>
                                </template> -->
                            </div>
                        </template>
                    </lightning-card>
                </template>

            </div>
        </div>
        <div class="slds-col slds-size_9-of-12">
            <div id="calendar" class="fullcalendarjs"></div>
        </div>
    </div>

    <!-- Open a modal with new event form  -->
    <template if:true={openModal}>
        <div data-modal="custommodal" class="modalclass">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">

                    <header class="slds-modal__header">
                        <lightning-button-icon icon-name="utility:close" class="slds-modal__close "
                            alternative-text="Close" title="Close" size="large" variant="bare-inverse"
                            onclick={cancelEventHandler}>
                        </lightning-button-icon>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">{ModalName}</h2>
                    </header>

                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <lightning-input label="Start Date" name="start" type="datetime" timezone="GMT"
                            onchange={changeHandler} value={curEvent.start} required></lightning-input>
                        <lightning-input label="End Date" name="end" type="datetime" timezone="GMT"
                            onchange={changeHandler} value={curEvent.end} required></lightning-input>
                        <!-- <lightning-formatted-number label="Work Hour" name="hours" value={curEvent.hours}
                            maximum-fraction-digits="2"></lightning-formatted-number> -->
                        <div class="slds-form-element">
                            <label class="slds-form-element__label slds-text-title_bold" for="workHours">Work
                                Hour</label>
                            <div class="slds-form-element__control">
                                <lightning-formatted-number class="slds-text-color_error" name="hours"
                                    value={curEvent.hours} maximum-fraction-digits="2">
                                </lightning-formatted-number>
                            </div>
                        </div>
                    </div>

                    <footer class="slds-modal__footer">
                        <div class="slds-grid slds-grid_align-spread slds-p-horizontal_small">
                            <template if:true={selectedId}>
                                <lightning-button label="Delete" title="Delete" icon-name="utility:delete"
                                    variant="destructive" onclick={removeEventHandler}></lightning-button>
                            </template>
                            <div class="slds-col_bump-left">
                                <lightning-button-group>
                                    <lightning-button label="Close" title="Close" icon-name="utility:close"
                                        onclick={cancelEventHandler}></lightning-button>
                                    <lightning-button label="Save" title="Save" variant="brand" icon-name="utility:save"
                                        onclick={saveEventHandler}></lightning-button>
                                </lightning-button-group>
                            </div>
                        </div>
                    </footer>

                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </template>
</template>